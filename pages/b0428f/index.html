<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Prometheus监控告警体系 | 喻好好</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="https://at.alicdn.com/t/font_3114978_qe0b39no76.css">
    <script language="javascript" type="text/javascript" src="/js/pgmanor-self.js"></script>
    <link rel="alternate" type="application/rss+xml" href="https://yuhaohao.github.io/rss.xml" title="喻好好 RSS Feed">
    <link rel="alternate" type="application/atom+xml" href="https://yuhaohao.github.io/feed.atom" title="喻好好 Atom Feed">
    <link rel="alternate" type="application/json" href="https://yuhaohao.github.io/feed.json" title="喻好好 JSON Feed">
    <meta name="description" content="目前有比较多的开源运维平台，内置了监控告警服务，我们可以直接结合实际的业务进行部署使用，例如蓝鲸平台/SPUG平台等。这里我们主要介绍下，在自建的k8s集群或者其它分布式系统中，如何快速搭建自己的监控告警平台。">
    <meta name="image" content="https://yuhaohao.github.io/img/monitor/1.png">
    <meta name="twitter:title" content="Prometheus监控告警体系">
    <meta name="twitter:description" content="目前有比较多的开源运维平台，内置了监控告警服务，我们可以直接结合实际的业务进行部署使用，例如蓝鲸平台/SPUG平台等。这里我们主要介绍下，在自建的k8s集群或者其它分布式系统中，如何快速搭建自己的监控告警平台。">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://yuhaohao.github.io/img/monitor/1.png">
    <meta name="twitter:url" content="https://yuhaohao.github.io/01.%E8%BF%90%E7%BB%B4/04.%E7%9B%91%E6%8E%A7%E5%91%8A%E8%AD%A6&%E5%BC%80%E5%8F%91/01.Prometheus%E7%9B%91%E6%8E%A7%E5%91%8A%E8%AD%A6%E4%BD%93%E7%B3%BB.html">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Prometheus监控告警体系">
    <meta property="og:description" content="目前有比较多的开源运维平台，内置了监控告警服务，我们可以直接结合实际的业务进行部署使用，例如蓝鲸平台/SPUG平台等。这里我们主要介绍下，在自建的k8s集群或者其它分布式系统中，如何快速搭建自己的监控告警平台。">
    <meta property="og:image" content="https://yuhaohao.github.io/img/monitor/1.png">
    <meta property="og:url" content="https://yuhaohao.github.io/01.%E8%BF%90%E7%BB%B4/04.%E7%9B%91%E6%8E%A7%E5%91%8A%E8%AD%A6&%E5%BC%80%E5%8F%91/01.Prometheus%E7%9B%91%E6%8E%A7%E5%91%8A%E8%AD%A6%E4%BD%93%E7%B3%BB.html">
    <meta property="og:site_name" content="喻好好">
    <meta property="article:published_time" content="2024-04-02T10:37:08.000Z">
    <meta property="article:tag" content="监控告警">
    <meta itemprop="name" content="Prometheus监控告警体系">
    <meta itemprop="description" content="目前有比较多的开源运维平台，内置了监控告警服务，我们可以直接结合实际的业务进行部署使用，例如蓝鲸平台/SPUG平台等。这里我们主要介绍下，在自建的k8s集群或者其它分布式系统中，如何快速搭建自己的监控告警平台。">
    <meta itemprop="image" content="https://yuhaohao.github.io/img/monitor/1.png">
    <meta name="keywords" content="运维,cicd,编程,生活">
    <meta name="baidu-site-verification" content="code-LTKHwOecxI">
    <meta name="theme-color" content="#11a8cd">
    <meta name="referrer" content="no-referrer-when-downgrade">
    
    <link rel="preload" href="/assets/css/0.styles.fe002bf3.css" as="style"><link rel="preload" href="/assets/js/app.6ef0f2ef.js" as="script"><link rel="preload" href="/assets/js/2.5e613b00.js" as="script"><link rel="preload" href="/assets/js/23.10e4ce03.js" as="script"><link rel="preload" href="/assets/js/8.d3d503a7.js" as="script"><link rel="preload" href="/assets/js/4.477e024d.js" as="script"><link rel="preload" href="/assets/js/5.4f2e6637.js" as="script"><link rel="prefetch" href="/assets/js/10.752350cf.js"><link rel="prefetch" href="/assets/js/11.c3c4720c.js"><link rel="prefetch" href="/assets/js/12.d4e65f6f.js"><link rel="prefetch" href="/assets/js/13.56235b1b.js"><link rel="prefetch" href="/assets/js/14.c9b5c90a.js"><link rel="prefetch" href="/assets/js/15.5c68cbcf.js"><link rel="prefetch" href="/assets/js/16.45482840.js"><link rel="prefetch" href="/assets/js/17.eaad4cee.js"><link rel="prefetch" href="/assets/js/18.5de09d7e.js"><link rel="prefetch" href="/assets/js/19.9497d032.js"><link rel="prefetch" href="/assets/js/20.ab91953a.js"><link rel="prefetch" href="/assets/js/21.ef838f93.js"><link rel="prefetch" href="/assets/js/22.489736bc.js"><link rel="prefetch" href="/assets/js/24.dd3e600f.js"><link rel="prefetch" href="/assets/js/25.19205e12.js"><link rel="prefetch" href="/assets/js/26.0ace4737.js"><link rel="prefetch" href="/assets/js/27.f7fc9de4.js"><link rel="prefetch" href="/assets/js/28.58e94180.js"><link rel="prefetch" href="/assets/js/29.05966678.js"><link rel="prefetch" href="/assets/js/3.8258299f.js"><link rel="prefetch" href="/assets/js/30.bf301e4a.js"><link rel="prefetch" href="/assets/js/31.49a43da7.js"><link rel="prefetch" href="/assets/js/32.63a6e6b4.js"><link rel="prefetch" href="/assets/js/33.84a77afa.js"><link rel="prefetch" href="/assets/js/34.fce29aa1.js"><link rel="prefetch" href="/assets/js/35.32a8e7fc.js"><link rel="prefetch" href="/assets/js/36.3a301563.js"><link rel="prefetch" href="/assets/js/37.97b9d7df.js"><link rel="prefetch" href="/assets/js/6.bed5989a.js"><link rel="prefetch" href="/assets/js/7.b6b7fef4.js"><link rel="prefetch" href="/assets/js/9.7137c7a6.js">
    <link rel="stylesheet" href="/assets/css/0.styles.fe002bf3.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="喻好好" class="logo"> <span class="site-name can-hide">喻好好</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="运维" class="dropdown-title"><a href="/ops/" class="link-title">运维</a> <span class="title" style="display:none;">运维</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/k8s/" class="nav-link">k8s</a></li><li class="dropdown-item"><!----> <a href="/storage/" class="nav-link">存储</a></li><li class="dropdown-item"><!----> <a href="/cicd/" class="nav-link">CICD</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编程" class="dropdown-title"><a href="/code/" class="link-title">编程</a> <span class="title" style="display:none;">编程</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/python/" class="nav-link">python</a></li><li class="dropdown-item"><!----> <a href="/golang/" class="nav-link">golang</a></li></ul></div></div><div class="nav-item"><a href="/life/" class="nav-link">生活</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="友链" class="dropdown-title"><!----> <span class="title" style="display:;">友链</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://www.cnblogs.com/yuhaohao" target="_blank" rel="noopener noreferrer" class="nav-link external">
  喻好好
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://wiki.eryajf.net/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  二丫讲梵
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://yanyunfeng.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  鄢云峰 YYF
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://doc.pursue.pub/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Pursue
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="/pages/ea589c/" class="nav-link">关于</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="页面" class="dropdown-title"><!----> <span class="title" style="display:;">页面</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>本站索引</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-subitem"><a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-subitem"><a href="/archives/" class="nav-link">归档</a></li></ul></li><li class="dropdown-item"><h4>我的工具</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://yiyan.baidu.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  文心一言
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://poe.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  POE.COM
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></div> <a href="https://github.com/yuhaohaozzz/yuhaohaozzz.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/muyan.jpg"> <div class="blogger-info"><h3>喻好好</h3> <span>得道多助,失道寡助</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="运维" class="dropdown-title"><a href="/ops/" class="link-title">运维</a> <span class="title" style="display:none;">运维</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/k8s/" class="nav-link">k8s</a></li><li class="dropdown-item"><!----> <a href="/storage/" class="nav-link">存储</a></li><li class="dropdown-item"><!----> <a href="/cicd/" class="nav-link">CICD</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编程" class="dropdown-title"><a href="/code/" class="link-title">编程</a> <span class="title" style="display:none;">编程</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/python/" class="nav-link">python</a></li><li class="dropdown-item"><!----> <a href="/golang/" class="nav-link">golang</a></li></ul></div></div><div class="nav-item"><a href="/life/" class="nav-link">生活</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="友链" class="dropdown-title"><!----> <span class="title" style="display:;">友链</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://www.cnblogs.com/yuhaohao" target="_blank" rel="noopener noreferrer" class="nav-link external">
  喻好好
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://wiki.eryajf.net/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  二丫讲梵
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://yanyunfeng.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  鄢云峰 YYF
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://doc.pursue.pub/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Pursue
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="/pages/ea589c/" class="nav-link">关于</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="页面" class="dropdown-title"><!----> <span class="title" style="display:;">页面</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>本站索引</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-subitem"><a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-subitem"><a href="/archives/" class="nav-link">归档</a></li></ul></li><li class="dropdown-item"><h4>我的工具</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://yiyan.baidu.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  文心一言
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://poe.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  POE.COM
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></div> <a href="https://github.com/yuhaohaozzz/yuhaohaozzz.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Kubernetes</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>CICD</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>分布式存储</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>监控告警&amp;开发</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/b0428f/" aria-current="page" class="active sidebar-link">Prometheus监控告警体系</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/b0428f/#前言" class="sidebar-link">前言</a></li><li class="sidebar-sub-header level2"><a href="/pages/b0428f/#promtheus监控体系介绍" class="sidebar-link">promtheus监控体系介绍</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/b0428f/#promtheus监控体系架构" class="sidebar-link">promtheus监控体系架构</a></li><li class="sidebar-sub-header level3"><a href="/pages/b0428f/#部署说明" class="sidebar-link">部署说明</a></li><li class="sidebar-sub-header level4"><a href="/pages/b0428f/#prometheus-operator原理" class="sidebar-link">prometheus-operator原理</a></li><li class="sidebar-sub-header level4"><a href="/pages/b0428f/#部署和资源实例介绍" class="sidebar-link">部署和资源实例介绍</a></li><li class="sidebar-sub-header level4"><a href="/pages/b0428f/#prometheus和servicemonitor关联" class="sidebar-link">prometheus和servicemonitor关联</a></li><li class="sidebar-sub-header level3"><a href="/pages/b0428f/#告警规则管理" class="sidebar-link">告警规则管理</a></li><li class="sidebar-sub-header level4"><a href="/pages/b0428f/#operator管理alertmanager实例" class="sidebar-link">operator管理alertmanager实例</a></li><li class="sidebar-sub-header level4"><a href="/pages/b0428f/#告警规则配置" class="sidebar-link">告警规则配置</a></li><li class="sidebar-sub-header level4"><a href="/pages/b0428f/#prometheus和alertmanager关联" class="sidebar-link">prometheus和alertmanager关联</a></li><li class="sidebar-sub-header level3"><a href="/pages/b0428f/#监控告警常用操作" class="sidebar-link">监控告警常用操作</a></li><li class="sidebar-sub-header level4"><a href="/pages/b0428f/#_1-查看告警规则相关配置" class="sidebar-link">1.查看告警规则相关配置</a></li><li class="sidebar-sub-header level4"><a href="/pages/b0428f/#修改告警规则并应用" class="sidebar-link">修改告警规则并应用</a></li></ul></li></ul></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper bg-style-6"><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/ops/#运维" data-v-06225672>运维</a></li><li data-v-06225672><a href="/ops/#监控告警&amp;开发" data-v-06225672>监控告警&amp;开发</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/yuhaohao" target="_blank" title="作者" class="beLink" data-v-06225672>喻好好</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2024-04-02</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABGpJREFUSA3tVVtoXFUU3fvOI53UlmCaKIFmwEhsE7QK0ipFEdHEKpXaZGrp15SINsXUWvBDpBgQRKi0+KKoFeJHfZA+ED9KKoIU2gYD9UejTW4rVIzm0VSTziPzuNu1z507dibTTjL4U/DAzLn3nL3X2o91ziX6f9wMFdh6Jvbm9nNSV0msViVO6tN1Rm7NMu2OpeJ9lWBUTDxrJbYTS0hInuwciu9eLHlFxCLCZEk3MegsJmZ5K/JD6t7FkFdEvGUo1g7qJoG3MHImqRIn8/nzY1K9UPKKiJmtnUqHVE3Gbuay6vJE/N2FEmuxFjW2nUuE0yQXRRxLiTUAzs36zhZvOXJPdX850EVnnLZkB8prodQoM5JGj7Xk2mvC7JB8tG04Ef5PiXtG0UtxupRQSfTnBoCy554x18yJHI6I+G5Eru4LHmPJZEQsrvPUbMiA8G/WgMK7w7I+ez7++o2ANfbrjvaOl1tFMs+htG3IrZH9/hDX1Pr8Tc0UvH8tcX29KzAgIGcEkINyW5BF9x891hw6VYqgJHEk0huccS7vh3C6gTiODL+26huuBtbct8eZnqLML8PkxGYpuPZBqtqwkSjgc4mB5gbgig5i+y0UDK35LMxXisn9xQtK+nd26gTIHsHe/oblK/b29fUmN/8Y+9jAQrnBp56m1LcDlDp9irKTExSKduXJVWSqdBMA08pEJnEIOB3FPPMybu/oeV8zFeYN3xx576Q6RH+VmplE4ncQV5v+5rzSoyOU7PuEAg8g803PwBJ0CExno/jcMbN8tONYeOmHiuUNryvm3fRUy4tMPVLdAGkUhNWuggGrJcXPv+ouCjz0MKUHz1J2/E8IC9nqTabcxgaBYM0hPhD5Y65FsbxRQKxCQrDjDctW7PUM3HuZunFyifSAqEfuzCp48Il24luWUWZoyJCaPR82jE0+kFA643wRFVni4RYSq3ohJO2pZ7B5dO4xkDWbEpossJPLSrPjYID8rS2UHTlvyNxqIGsg674XJJ7vnh5L7PNwC4hh2sjCI96mzszOTpxLF0T7l88Yz7lAuK6OnL8gXLOnTvpzSb22YG8W7us3jSebFHeeqnXRG1vt+MoUM84LQIBmMsCTAcOauTh0T0l0neQK7m2bLMt2mGxU3HYssS0J2cdv5wljlPsrIuZLAG/2DOZIXgCYT8uMGZN+e2kSirfxZOPCsC0f24nTZzspnVn9VePS1Z5vubmAGGXG8ZFno9Hel0yfA5ZPhF7Dh972BQJ2qCpgH67lmWtBYbvk6sz02wjky2vXyz0XErP/kFB619js1BtwfOV4OPRqOQBjy3Qbk18vigUPPSD5ceHnwck7W9bhAqZdd7SuG7w4/P2F/GaJh8c7e9qgow+Q7cGBo+98WsLkuktFqiZabtXuQTu/Y5ETbR0v7tNSFnvrmu6pjdoan2KjMu8q/Hmj1EfCO2ZGfEIbIXKUlw8qaX9/b2oeSJmFksSeT/Fn0V3nSypChh4Gjh74ybO9aeZ/AN2dwciu2/MhAAAAAElFTkSuQmCC">Prometheus监控告警体系<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <p>目前有比较多的开源运维平台，内置了监控告警服务，我们可以直接结合实际的业务进行部署使用，例如蓝鲸平台/SPUG平台等。这里我们主要介绍下，在自建的k8s集群或者其它分布式系统中，如何快速搭建自己的监控告警平台。</p> <p>当前比较主流的监控告警平台，很多都是基于Prometheus + Grafana + AlertManager的方案来实现，当前也可以采用 <a href="https://github.com/VictoriaMetrics/VictoriaMetrics" target="_blank" rel="noopener noreferrer">VictoriaMetrics<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>的监控方案，这里也是目前我这边在运维大规模集群采用的比较多的监控方案。当前比较传统的方案Zabbix/Nagios这些根据实际业务的需求也可以采用，这里就不再进行介绍。</p> <p>下面我们具体介绍下Prometheus + Grafana + AlertManager的告警体系</p> <h2 id="promtheus监控体系介绍"><a href="#promtheus监控体系介绍" class="header-anchor">#</a> promtheus监控体系介绍</h2> <h3 id="promtheus监控体系架构"><a href="#promtheus监控体系架构" class="header-anchor">#</a> promtheus监控体系架构</h3> <p><img src="/img/monitor/1.png" alt=""></p> <ul><li>prometheus server
这里prometheus server是prometheus的核心，相当于时间序列数据库，负责从<code>exporter</code>拉取和存储监控数据，并提供一套灵活的查询语言（PromQL）供用户使用。prometheus server本身也提供了自己的metrics接口。</li> <li>alertmanager
这里alertmanager是报警组件（prometheus配置报警事件的采集规则，alertmanager配置的报警信息的发送规则），用户可以定义基于监控数据的告警规则，规则会触发告警。一旦<code>alermanager</code>收到告警，会通过预定义的方式发出告警通知。</li> <li>grafana
这里grafana是监控可视化报表组件。不仅支持prometheus，还支持很多三方数据库，如InfulxDB等。</li> <li>exporter
exporter是用来监控应用并采集metric信息的组件统称，负责收集目标对象（host, 容器等…）的性能数据，并通过HTTP接口供 Prometheus Server获取。</li> <li>pushgateway
pushgateway是数据采用的插件，采用被动推送来获取监控数据，用户可以把把需要监控的数据发送给pushgateway，pushgateway再将数据推送给prometheus server。</li></ul> <h3 id="部署说明"><a href="#部署说明" class="header-anchor">#</a> 部署说明</h3> <p>这里，prometheus监控告警体系，可以采用二进制，或者容器化的部署方案。为了简化k8s集群监控告警体系的部署和复杂度，CoreOS公司开发了一套Prometheus-Operator的开源方案，用户可以非常简单的在kubernetes集群中部署Prometheus生态服务，通过简单的声明和配置来管理Promtheus实例，这些配置将响应、创建、配置和管理Prometheus监控实例。</p> <h4 id="prometheus-operator原理"><a href="#prometheus-operator原理" class="header-anchor">#</a> prometheus-operator原理</h4> <p><img src="/img/monitor/1.png" alt=""></p> <p>从本质上来讲Prometheus属于是典型的有状态应用，而其有包含了一些自身特有的运维管理和配置管理方式。而这些都无法通过Kubernetes原生提供的应用管理概念实现自动化。Operator的出现简化了这类应用程序的管理复杂度。它在Kubernetes基本的Resource和Controller的概念上，以扩展Kubernetes api的形式。帮助用户创建，配置和管理复杂的有状态应用程序。从而实现特定应用程序的常见操作以及运维自动化。</p> <ul><li><p>Operator： 根据自定义资源（Custom Resource Definition / CRDs）来部署和管理 Prometheus Server，同时监控这些自定义资源事件的变化来做相应的处理，是整个系统的控制中心，也就是我们常用的控制器，可见operater让prometheus更加k8s。</p></li> <li><p>Prometheus：声明式创建和管理Prometheus Server实例。</p></li> <li><p>Prometheus Server： Operator根据自定义资源Prometheus类型中定义的内容而部署的Prometheus Server集群，这些自定义资源可以看作是用来管理Prometheus Server集群的 StatefulSets 资源。</p></li> <li><p>ServiceMonitor：声明指定监控的服务，描述了一组被Prometheus监控的目标列表。该资源通过Labels来选取对应的Service Endpoint，让 Prometheus Server通过选取的 Service来获取Metrics信息。</p></li> <li><p>Service：简单的说就是Prometheus监控的对象。</p></li> <li><p>Alertmanager：定义AlertManager deployment期望的状态，Operator确保这个deployment运行时一直与定义保持一致。</p></li></ul> <h4 id="部署和资源实例介绍"><a href="#部署和资源实例介绍" class="header-anchor">#</a> 部署和资源实例介绍</h4> <p>这里部署请参考官方文档：https://github.com/prometheus-operator/prometheus-operator</p> <ul><li>prometheus实例</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@yuhaohao ~<span class="token punctuation">]</span><span class="token comment"># kubectl get prometheuses.monitoring.coreos.com -n monitoring</span>
NAME                    VERSION   DESIRED   READY   RECONCILED   AVAILABLE   AGE
prometheus-prometheus             <span class="token number">1</span>         <span class="token number">1</span>       True         True        284d
<span class="token punctuation">[</span>root@yuhaohao ~<span class="token punctuation">]</span><span class="token comment"># kubectl get pod -n monitoring |grep prometheus</span>
prometheus-prometheus-prometheus-0               <span class="token number">2</span>/2     Running   <span class="token number">0</span>          51d
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>servicemonitor 示例配置</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 下面以ping-exporter为例，进行了说明servicemonitor和service的配置信息</span>
<span class="token punctuation">[</span>root@yuhaohao ~<span class="token punctuation">]</span><span class="token comment"># kubectl get service -n monitoring ping-exporter -o yaml</span>
apiVersion: v1
kind: Service
metadata:
  labels:
    app.kubernetes.io/instance: ping-exporter
    app.kubernetes.io/name: ping-exporter
  name: ping-exporter
  namespace: monitoring
spec:
  ports:
  - name: http
    port: <span class="token number">9427</span>
    protocol: TCP
    targetPort: http
  selector:
    app.kubernetes.io/instance: ping-exporter
    app.kubernetes.io/name: ping-exporter
  type: ClusterIP

<span class="token punctuation">[</span>root@yuhaohao ~<span class="token punctuation">]</span><span class="token comment"># cat ping-exporter-servicemonitor.yaml</span>
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  labels:
    app.kubernetes.io/instance: ping-exporter
    app.kubernetes.io/name: ping-exporter
  name: ping-exporter
  namespace: monitoring
spec:
  <span class="token comment"># 指定job的标签，可以不设置。</span>
  jobLabel: k8s-app
  endpoints:
  - honorLabels: <span class="token boolean">true</span>
    <span class="token comment"># 监控数据抓取的时间间隔</span>
    interval: 30s
    <span class="token comment"># 指定metrics端口，这个port对应services.spec.ports.name</span>
    port: http
  <span class="token comment"># 监控目标Service所在的命名空间</span>
  namespaceSelector:
    matchNames:
    - monitoring
  <span class="token comment"># 监控目标Service目标的标签。</span>
  selector:
    <span class="token comment"># 注意，这个标签要和etcd的service的标签保持一致</span>
    matchLabels:
      app.kubernetes.io/instance: ping-exporter
      app.kubernetes.io/name: ping-exporter
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br></div></div><p><img src="/img/monitor/3.png" alt=""></p> <p>创建servicemonitor完毕后，此时我们查看prometheus的配置(在prometheus的Status-&gt;Configuration)可以发现，自动多了一条job_name的配置：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>- job_name: serviceMonitor/monitoring/ping-exporter/0
  honor_labels: <span class="token boolean">true</span>
  honor_timestamps: <span class="token boolean">true</span>
  scrape_interval: 30s
  scrape_timeout: 10s
  metrics_path: /metrics
  scheme: http
  follow_redirects: <span class="token boolean">true</span>
  enable_http2: <span class="token boolean">true</span>
  relabel_configs:
  - source_labels: <span class="token punctuation">[</span>job<span class="token punctuation">]</span>
    separator: <span class="token punctuation">;</span>
    regex: <span class="token punctuation">(</span>.*<span class="token punctuation">)</span>
    target_label: __tmp_prometheus_job_name
    replacement: <span class="token variable">$1</span>
    action: replace
  - source_labels: <span class="token punctuation">[</span>__meta_kubernetes_service_label_app_kubernetes_io_instance, __meta_kubernetes_service_labelpresent_app_kubernetes_io_instance<span class="token punctuation">]</span>
    separator: <span class="token punctuation">;</span>
    regex: <span class="token punctuation">(</span>ping-exporter<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token boolean">true</span>
    replacement: <span class="token variable">$1</span>
    action: keep
  - source_labels: <span class="token punctuation">[</span>__meta_kubernetes_service_label_app_kubernetes_io_name, __meta_kubernetes_service_labelpresent_app_kubernetes_io_name<span class="token punctuation">]</span>
    separator: <span class="token punctuation">;</span>
    regex: <span class="token punctuation">(</span>ping-exporter<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token boolean">true</span>
    replacement: <span class="token variable">$1</span>
    action: keep
  - source_labels: <span class="token punctuation">[</span>__meta_kubernetes_endpoint_port_name<span class="token punctuation">]</span>
    separator: <span class="token punctuation">;</span>
    regex: http
    replacement: <span class="token variable">$1</span>
    action: keep
  - source_labels: <span class="token punctuation">[</span>__meta_kubernetes_endpoint_address_target_kind, __meta_kubernetes_endpoint_address_target_name<span class="token punctuation">]</span>
    separator: <span class="token punctuation">;</span>
    regex: Node<span class="token punctuation">;</span><span class="token punctuation">(</span>.*<span class="token punctuation">)</span>
    target_label: <span class="token function">node</span>
    replacement: <span class="token variable">${1}</span>
    action: replace
  - source_labels: <span class="token punctuation">[</span>__meta_kubernetes_endpoint_address_target_kind, __meta_kubernetes_endpoint_address_target_name<span class="token punctuation">]</span>
    separator: <span class="token punctuation">;</span>
    regex: Pod<span class="token punctuation">;</span><span class="token punctuation">(</span>.*<span class="token punctuation">)</span>
    target_label: pod
    replacement: <span class="token variable">${1}</span>
    action: replace
  - source_labels: <span class="token punctuation">[</span>__meta_kubernetes_namespace<span class="token punctuation">]</span>
    separator: <span class="token punctuation">;</span>
    regex: <span class="token punctuation">(</span>.*<span class="token punctuation">)</span>
    target_label: namespace
    replacement: <span class="token variable">$1</span>
    action: replace
  - source_labels: <span class="token punctuation">[</span>__meta_kubernetes_service_name<span class="token punctuation">]</span>
    separator: <span class="token punctuation">;</span>
    regex: <span class="token punctuation">(</span>.*<span class="token punctuation">)</span>
    target_label: <span class="token function">service</span>
    replacement: <span class="token variable">$1</span>
    action: replace
  - source_labels: <span class="token punctuation">[</span>__meta_kubernetes_pod_name<span class="token punctuation">]</span>
    separator: <span class="token punctuation">;</span>
    regex: <span class="token punctuation">(</span>.*<span class="token punctuation">)</span>
    target_label: pod
    replacement: <span class="token variable">$1</span>
    action: replace
  - source_labels: <span class="token punctuation">[</span>__meta_kubernetes_pod_container_name<span class="token punctuation">]</span>
    separator: <span class="token punctuation">;</span>
    regex: <span class="token punctuation">(</span>.*<span class="token punctuation">)</span>
    target_label: container
    replacement: <span class="token variable">$1</span>
    action: replace
  - source_labels: <span class="token punctuation">[</span>__meta_kubernetes_pod_phase<span class="token punctuation">]</span>
    separator: <span class="token punctuation">;</span>
    regex: <span class="token punctuation">(</span>Failed<span class="token operator">|</span>Succeeded<span class="token punctuation">)</span>
    replacement: <span class="token variable">$1</span>
    action: drop
  - source_labels: <span class="token punctuation">[</span>__meta_kubernetes_service_name<span class="token punctuation">]</span>
    separator: <span class="token punctuation">;</span>
    regex: <span class="token punctuation">(</span>.*<span class="token punctuation">)</span>
    target_label: job
    replacement: <span class="token variable">${1}</span>
    action: replace
  - source_labels: <span class="token punctuation">[</span>__meta_kubernetes_service_label_jobLabel<span class="token punctuation">]</span>
    separator: <span class="token punctuation">;</span>
    regex: <span class="token punctuation">(</span>.+<span class="token punctuation">)</span>
    target_label: job
    replacement: <span class="token variable">${1}</span>
    action: replace
  - separator: <span class="token punctuation">;</span>
    regex: <span class="token punctuation">(</span>.*<span class="token punctuation">)</span>
    target_label: endpoint
    replacement: http
    action: replace
  - source_labels: <span class="token punctuation">[</span>__address__<span class="token punctuation">]</span>
    separator: <span class="token punctuation">;</span>
    regex: <span class="token punctuation">(</span>.*<span class="token punctuation">)</span>
    modulus: <span class="token number">1</span>
    target_label: __tmp_hash
    replacement: <span class="token variable">$1</span>
    action: hashmod
  - source_labels: <span class="token punctuation">[</span>__tmp_hash<span class="token punctuation">]</span>
    separator: <span class="token punctuation">;</span>
    regex: <span class="token string">&quot;0&quot;</span>
    replacement: <span class="token variable">$1</span>
    action: keep
  kubernetes_sd_configs:
  - role: endpoints
    kubeconfig_file: <span class="token string">&quot;&quot;</span>
    follow_redirects: <span class="token boolean">true</span>
    enable_http2: <span class="token boolean">true</span>
    namespaces:
      own_namespace: <span class="token boolean">false</span>
      names:
      - monitoring
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br></div></div><h4 id="prometheus和servicemonitor关联"><a href="#prometheus和servicemonitor关联" class="header-anchor">#</a> prometheus和servicemonitor关联</h4> <p>Prometheus与ServiceMonitor之间的关联关系使用serviceMonitorSelector定义，在Prometheus中通过标签选择当前需要监控的ServiceMonitor对象。
Prometheus的定义如下所示： 为了能够让Prometheus关联到ServiceMonitor，需要在Pormtheus定义中使用serviceMonitorSelector</p> <p>为空表示可以关联任意命名空间下的标签，下面是具体的示例说明</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@yuhaohao ~<span class="token punctuation">]</span><span class="token comment"># kubectl get prometheuses.monitoring.coreos.com -n monitoring  -o yaml</span>
apiVersion: v1
items:
- apiVersion: monitoring.coreos.com/v1
  kind: Prometheus
  metadata:
    annotations:
      meta.helm.sh/release-name: prometheus
      meta.helm.sh/release-namespace: monitoring
    creationTimestamp: <span class="token string">&quot;2024-01-15T07:35:18Z&quot;</span>
    generation: <span class="token number">5</span>
    labels:
      app.kubernetes.io/component: prometheus
      app.kubernetes.io/instance: prometheus
      app.kubernetes.io/managed-by: Helm
      app.kubernetes.io/name: kube-prometheus
      app.kubernetes.io/version: <span class="token number">0.68</span>.0
      helm.sh/chart: kube-prometheus-8.21.2
    name: prometheus-prometheus
    namespace: monitoring
    resourceVersion: <span class="token string">&quot;502245405&quot;</span>
    uid: 55ba062e-9397-47b5-aa0c-75f8085a038d
  spec:
    affinity:
      podAntiAffinity:
        preferredDuringSchedulingIgnoredDuringExecution:
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
    enableAdminAPI: <span class="token boolean">false</span>
    enableRemoteWriteReceiver: <span class="token boolean">false</span>
    evaluationInterval: 30s
    externalUrl: http://prometheus-prometheus.monitoring:9090/
    image: bitnami/prometheus:2.47.0-debian-11-r26
    imagePullSecrets:
    - name: inner
    listenLocal: <span class="token boolean">false</span>
    logFormat: logfmt
    logLevel: info
    paused: <span class="token boolean">false</span>
    podMetadata:
      labels:
        app.kubernetes.io/component: prometheus
        app.kubernetes.io/name: prometheus
        prometheus: prometheus-prometheus
    podMonitorNamespaceSelector: <span class="token punctuation">{</span><span class="token punctuation">}</span>
    podMonitorSelector: <span class="token punctuation">{</span><span class="token punctuation">}</span>
    portName: web
    probeNamespaceSelector: <span class="token punctuation">{</span><span class="token punctuation">}</span>
    probeSelector: <span class="token punctuation">{</span><span class="token punctuation">}</span>
    replicas: <span class="token number">1</span>
    retention: 60d
    routePrefix: /
    ruleNamespaceSelector: <span class="token punctuation">{</span><span class="token punctuation">}</span>
    ruleSelector:
      matchLabels:
        prometheus: alertmanager
        role-define: alerts
    scrapeConfigNamespaceSelector: <span class="token punctuation">{</span><span class="token punctuation">}</span>
    scrapeConfigSelector: <span class="token punctuation">{</span><span class="token punctuation">}</span>
    scrapeInterval: 30s
    securityContext:
      fsGroup: <span class="token number">1001</span>
      runAsUser: <span class="token number">1001</span>
    serviceAccountName: prometheus-prometheus
    serviceMonitorNamespaceSelector: <span class="token punctuation">{</span><span class="token punctuation">}</span>
    serviceMonitorSelector: <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br></div></div><h3 id="告警规则管理"><a href="#告警规则管理" class="header-anchor">#</a> 告警规则管理</h3> <h4 id="operator管理alertmanager实例"><a href="#operator管理alertmanager实例" class="header-anchor">#</a> operator管理alertmanager实例</h4> <p>通过Prometheus Operator管理Alertmanager实例，用户可以通过自定义资源Alertmanager进行定义，如下所示
当replicas大于1时，Prometheus Operator会自动通过集群的方式创建Alertmanager:</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@yuhaohao ~<span class="token punctuation">]</span><span class="token comment"># kubectl get alertmanagers.monitoring.coreos.com -n monitoring -o yaml</span>
apiVersion: v1
items:
- apiVersion: monitoring.coreos.com/v1
  kind: Alertmanager
  metadata:
    annotations:
      meta.helm.sh/release-name: prometheus
      meta.helm.sh/release-namespace: monitoring
    creationTimestamp: <span class="token string">&quot;2024-01-15T07:35:18Z&quot;</span>
    generation: <span class="token number">1</span>
    labels:
      app.kubernetes.io/component: alertmanager
      app.kubernetes.io/instance: prometheus
      app.kubernetes.io/managed-by: Helm
      app.kubernetes.io/name: kube-prometheus
      app.kubernetes.io/version: <span class="token number">0.68</span>.0
      helm.sh/chart: kube-prometheus-8.21.2
    name: prometheus-alertmanager
    namespace: monitoring
    resourceVersion: <span class="token string">&quot;152700636&quot;</span>
    uid: 10e4b2e4-4e5d-4a1a-a289-c8a809894060
  spec:
    affinity:
      podAntiAffinity:
        preferredDuringSchedulingIgnoredDuringExecution:
        - podAffinityTerm:
            labelSelector:
              matchLabels:
                app.kubernetes.io/component: alertmanager
                app.kubernetes.io/instance: prometheus
                app.kubernetes.io/name: kube-prometheus
            topologyKey: kubernetes.io/hostname
          weight: <span class="token number">1</span>
    containers:
    <span class="token punctuation">..</span><span class="token punctuation">..</span>.
    externalUrl: http://prometheus-alertmanager.monitoring:9093/
    image: bitnami/alertmanager:0.26.0-debian-11-r38
    imagePullSecrets:
    - name: inner
    listenLocal: <span class="token boolean">false</span>
    logFormat: logfmt
    logLevel: info
    paused: <span class="token boolean">false</span>
    podMetadata:
      labels:
        alertmanager: prometheus-alertmanager
        app.kubernetes.io/component: alertmanager
        app.kubernetes.io/name: alertmanager
    portName: web
    replicas: <span class="token number">1</span>
    resources: <span class="token punctuation">{</span><span class="token punctuation">}</span>
    retention: 120h
    routePrefix: /
    securityContext:
      fsGroup: <span class="token number">1001</span>
      runAsUser: <span class="token number">1001</span>
    serviceAccountName: prometheus-alertmanager
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br></div></div><h4 id="告警规则配置"><a href="#告警规则配置" class="header-anchor">#</a> 告警规则配置</h4> <p>在Prometheus Operator模式中，告警规则也编程一个通过Kubernetes API声明式创建的一个资源，如下所示：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@yuhaohao ~<span class="token punctuation">]</span><span class="token comment"># cat k8s-ping-rules.yaml</span>
apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  name: k8s-ping-rules
  namespace: monitoring
  labels:
    prometheus: alertmanager
    role-define: alerts
spec:
  groups:
    - name: k8s-ping.rules
      rules:
        - alert: 节点异常无法连通
          expr: ping_loss_ratio<span class="token punctuation">{</span>job<span class="token operator">=</span><span class="token string">&quot;ping-exporter&quot;</span><span class="token punctuation">}</span> <span class="token operator">==</span> <span class="token number">1</span>
          for: 1m
          labels:
            severity: P0
          annotations:
            summary: 集群节点无法连通
            description: <span class="token string">&quot;k8s集群主机: {{ <span class="token variable">$labels</span>.target }} Ping Loss, 检查节点是否宕机.&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>告警规则创建成功后，通过在Prometheus中使用ruleSelector通过选择需要关联的PrometheusRule即可，具体如下：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@yuhaohao ~<span class="token punctuation">]</span><span class="token comment"># kubectl get prometheuses.monitoring.coreos.com -n monitoring  -o yaml</span>
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
ruleSelector:
    matchLabels:
        prometheus: alertmanager
        role-define: alerts
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>Prometheus重新加载配置后，从UI中我们可以查看到通过PrometheusRule自动创建的告警规则配置：
<img src="/img/monitor/4.png" alt=""></p> <h4 id="prometheus和alertmanager关联"><a href="#prometheus和alertmanager关联" class="header-anchor">#</a> prometheus和alertmanager关联</h4> <p>通过在Prometheus中使用alerting指定使用的Alertmanager资源即可</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@yuhaohao ~<span class="token punctuation">]</span><span class="token comment"># kubectl get prometheuses.monitoring.coreos.com -n monitoring prometheus-prometheus -o yaml</span>
apiVersion: monitoring.coreos.com/v1
kind: Prometheus
metadata:
  annotations:
    meta.helm.sh/release-name: prometheus
    meta.helm.sh/release-namespace: monitoring
  creationTimestamp: <span class="token string">&quot;2024-01-15T07:35:18Z&quot;</span>
  generation: <span class="token number">5</span>
  labels:
    app.kubernetes.io/component: prometheus
    app.kubernetes.io/instance: prometheus
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: kube-prometheus
    app.kubernetes.io/version: <span class="token number">0.68</span>.0
    helm.sh/chart: kube-prometheus-8.21.2
  name: prometheus-prometheus
  namespace: monitoring
  resourceVersion: <span class="token string">&quot;502279004&quot;</span>
  uid: 55ba062e-9397-47b5-aa0c-75f8085a038d
spec:
  affinity:
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
      - podAffinityTerm:
          labelSelector:
            matchLabels:
              app.kubernetes.io/component: prometheus
              app.kubernetes.io/instance: prometheus
              app.kubernetes.io/name: kube-prometheus
          topologyKey: kubernetes.io/hostname
  <span class="token comment"># 这里制定alerting使用指定的Alertmanager资源</span>
  alerting:
    alertmanagers:
    - name: prometheus-alertmanager
      namespace: monitoring
      pathPrefix: /
      port: http
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><h3 id="监控告警常用操作"><a href="#监控告警常用操作" class="header-anchor">#</a> 监控告警常用操作</h3> <h4 id="_1-查看告警规则相关配置"><a href="#_1-查看告警规则相关配置" class="header-anchor">#</a> 1.查看告警规则相关配置</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@yuhaohao ~<span class="token punctuation">]</span><span class="token comment"># kubectl get secrets -n monitoring alertmanager-prometheus-alertmanager -o yaml</span>
apiVersion: v1
data:
  alertmanager.yaml: <span class="token assign-left variable">Z2xvYmFsOgogIHJlc29sdmVfdGltZW91dDogNW0KcmVjZWl2ZXJzOgotIG5hbWU6IHdlYmhvb2sKICB3ZWJob29rX2NvbmZpZ3M6CiAgLSBzZW5kX3Jlc29sdmVkOiB0cnVlCiAgICB1cmw6IGh0dHA6Ly8xMC4xOTguMy4yNToyNTI1L2FsZXJ0Ci0gbmFtZTogd2ViaG9va3AwCiAgd2ViaG9va19jb25maWdzOgogICOiDogMzBtCg</span><span class="token operator">==</span>
kind: Secret
metadata:
  creationTimestamp: <span class="token string">&quot;2024-10-16T03:22:53Z&quot;</span>
  name: alertmanager-prometheus-alertmanager
  namespace: monitoring
  resourceVersion: <span class="token string">&quot;489955086&quot;</span>
  uid: d5b23ac5-1778-42ab-a002-af6d0b0bdd75
type: Opaque

<span class="token comment"># 这里告警规则实际上保持在alertmanager-&lt;name-of-alertmanager-object&gt;的secret中，可以对内容进行base64解码查看</span>
<span class="token punctuation">[</span>root@yuhaohao ~<span class="token punctuation">]</span><span class="token comment"># echo &quot;Z2xvYmFsOgogIHJlc29sdmVfdGltZW91dDogNW0KcmVjZWl2ZXJzOgotIG5hbWU6IHdlYmhvb2sKICB3ZWJob29rX2NvbmZpZ3M6CiAgLSBzZW5kX3Jlc29sdmVkOiB0cnVlCiAgICB1cmw6IGh0dHA6Ly8xMC4xOTguMy4yNToyNTI1L2FsZXJ0Ci0gbmFtZTogd2ViaG9va3AwCiAgd2ViaG9va19jb25maWdzOgogICOiDogMzBtCg==&quot; |base64 -d </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h4 id="修改告警规则并应用"><a href="#修改告警规则并应用" class="header-anchor">#</a> 修改告警规则并应用</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 加解码后的alertmanager的配置导出到文件</span>
<span class="token punctuation">[</span>root@yuhaohao ~<span class="token punctuation">]</span><span class="token comment"># echo &quot;Z2xvYmFsOgogIHJlc29sdmVfdGltZW91dDogNW0KcmVjZWl2ZXJzOgotIG5hbWU6IHdlYmhvb2sKICB3ZWJob29rX2NvbmZpZ3M6CiAgLSBzZW5kX3Jlc29sdmVkOiB0cnVlCiAgICB1cmw6IGh0dHA6Ly8xMC4xOTguMy4yNToyNTI1L2FsZXJ0Ci0gbmFtZTogd2ViaG9va3AwCiAgd2ViaG9va19jb25maWdzOgogICOiDogMzBtCg==&quot; |base64 -d  &gt;&gt; alertmanager.yaml</span>

<span class="token comment"># 清理旧的alertmanager secret</span>
<span class="token punctuation">[</span>root@yuhaohao ~<span class="token punctuation">]</span><span class="token comment"># kubectl delete secrets -n monitoring alertmanager-prometheus-alertmanager</span>

<span class="token comment"># 应用新的alertmanager secret配置</span>
<span class="token punctuation">[</span>root@yuhaohao ~<span class="token punctuation">]</span><span class="token comment"># kubectl -n monitoring create secret generic alertmanager-prometheus-alertmanager  --from-file ./alertmanager.yaml</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></div></div> <!----> <div class="page-edit"><!----> <div class="tags"><a href="/tags/?tag=%E7%9B%91%E6%8E%A7%E5%91%8A%E8%AD%A6" title="标签">#监控告警</a></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2024/10/25, 15:36:54</span></div></div> <div class="page-nav-wapper"><!----> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/b0402f/" class="prev">k8s集群使用外部ceph集群存储</a></span> <!----></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/ea588c/"><div>
            清明节
            <!----></div></a> <span class="date">04-03</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/b0402g/"><div>
            容器异常退出状态码
            <!----></div></a> <span class="date">04-02</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/b0402f/"><div>
            k8s集群使用外部ceph集群存储
            <!----></div></a> <span class="date">04-02</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="https://github.com/yuhaohao" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="mailto:shengyinyu@163.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a title="订阅" target="_blank" class="iconfont icon-rss"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> <!----></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><canvas id="vuepress-canvas-cursor"></canvas><!----><div></div><div></div><div></div><div></div><div></div></div></div>
    <script src="/assets/js/app.6ef0f2ef.js" defer></script><script src="/assets/js/2.5e613b00.js" defer></script><script src="/assets/js/23.10e4ce03.js" defer></script><script src="/assets/js/8.d3d503a7.js" defer></script><script src="/assets/js/4.477e024d.js" defer></script><script src="/assets/js/5.4f2e6637.js" defer></script>
  </body>
</html>
